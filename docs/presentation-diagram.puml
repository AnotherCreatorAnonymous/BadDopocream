@startuml Bad_Dopo_Cream_Presentation

' ============================================
' DIAGRAMA DE CLASES DE PRESENTACIÓN
' Bad Dopo Cream - DOPO 2025
' Arquitectura MVC - Capa de Presentación (Vista)
' Última actualización: Diciembre 2025
' ============================================

skinparam classAttributeIconSize 0
skinparam backgroundColor #FEFEFE
skinparam class {
    BackgroundColor<<JFrame>> LightBlue
    BackgroundColor<<JPanel>> LightGreen
    BackgroundColor<<Configurator>> LightYellow
    BackgroundColor<<Enum>> LightPink
    BackgroundColor<<JMenuBar>> LightCoral
    BorderColor Black
    ArrowColor Black
}

' ============================================
' VENTANA PRINCIPAL
' ============================================

class BadDopoCreamGUI <<JFrame>> {
    - game: BadDopoCream
    - currentGameMode: String
    - currentPlayer1Character: String
    - currentPlayer2Character: String
    - currentEnemyCharacter: String
    - currentLevelNumber: int
    - currentPlayer1Name: String
    - currentPlayer2Name: String
    + BadDopoCreamGUI()
    + {static} main(args: String[]): void
    - showWelcomeScreen(): void
    - showMenuPanel(): void
    - showOptionsScreen(): void
    - showGameModeSelection(): void
    - showCharacterSelection(gameMode: String): void
    - showPvPModeSelection(): void
    - showPvPCharacterSelection(gameMode: String): void
    - showLevelSelection(gameMode: String, ...): void
    - showLevelConfigurationScreen(gameMode: String, ...): void
    - showGameScreen(gameMode: String, level: Level, ...): void
    + continueToNextLevel(): void
    + restartLevel(): void
    - showSaveLoadScreen(): void
    - showHighScoresScreen(): void
    + loadGameFromState(state: GameState): void
    - changePanel(panel: JPanel): void
    - initializeGameInBackend(...): void
}

' ============================================
' BARRA DE MENÚ
' ============================================

class GameMenuBar <<JMenuBar>> {
    - parentFrame: JFrame
    - onNewGame: Runnable
    - onSaveGame: Runnable
    - onLoadGame: Runnable
    + GameMenuBar(parentFrame: JFrame)
    + setOnNewGame(action: Runnable): void
    + setOnSaveGame(action: Runnable): void
    + setOnLoadGame(action: Runnable): void
    - createGameMenu(): JMenu
    - createHelpMenu(): JMenu
    - exitGame(): void
}

' ============================================
' PANTALLAS PRINCIPALES (JPANEL)
' ============================================

class WelcomeScreen <<JPanel>> {
    - backgroundImage: Image
    - titleLabel: JLabel
    - startButton: JButton
    - onStart: Runnable
    + WelcomeScreen(onStart: Runnable)
    - setupPanel(): void
    - createComponents(): void
    - layoutComponents(): void
    # paintComponent(g: Graphics): void
}

class MenuPanel <<JPanel>> {
    - backgroundImage: Image
    - newGameButton: JButton
    - loadGameButton: JButton
    - optionsButton: JButton
    - creditsButton: JButton
    - highScoresButton: JButton
    - exitButton: JButton
    - onNewGame: Runnable
    - onLoadGame: Runnable
    - onOptions: Runnable
    - onCredits: Runnable
    - onHighScores: Runnable
    + MenuPanel()
    + setOnNewGame(action: Runnable): void
    + setOnLoadGame(action: Runnable): void
    + setOnOptions(action: Runnable): void
    + setOnCredits(action: Runnable): void
    + setOnHighScores(action: Runnable): void
    - setupPanel(): void
    - createComponents(): void
    - layoutComponents(): void
    # paintComponent(g: Graphics): void
}

class OptionsScreen <<JPanel>> {
    - backgroundImage: Image
    - volumeSlider: JSlider
    - backButton: JButton
    - onBack: Runnable
    + OptionsScreen(onBack: Runnable)
    - setupPanel(): void
    # paintComponent(g: Graphics): void
}

class GameModeSelectionScreen <<JPanel>> {
    - backgroundImage: Image
    - normalModeButton: JButton
    - pvpModeButton: JButton
    - pvmModeButton: JButton
    - machineVsMachineButton: JButton
    - backButton: JButton
    - onNormalMode: Runnable
    - onPvPMode: Runnable
    - onPvMMode: Runnable
    - onMachineVsMachine: Runnable
    - onBack: Runnable
    + GameModeSelectionScreen(onBack: Runnable)
    + setOnNormalMode(action: Runnable): void
    + setOnPvPMode(action: Runnable): void
    + setOnPvMMode(action: Runnable): void
    + setOnMachineVsMachine(action: Runnable): void
    - setupPanel(): void
    - createComponents(): void
    # paintComponent(g: Graphics): void
}

class CharacterSelectionScreen <<JPanel>> {
    - backgroundImage: Image
    - chocolateButton: JButton
    - strawberryButton: JButton
    - vanillaButton: JButton
    - backButton: JButton
    - playerNameField: JTextField
    - onCharacterSelected: BiConsumer<String, String>
    - onBack: Runnable
    + CharacterSelectionScreen(onBack: Runnable)
    + setOnCharacterSelected(action: BiConsumer<String, String>): void
    - setupPanel(): void
    - createComponents(): void
    # paintComponent(g: Graphics): void
}

class PvPModeSelectionScreen <<JPanel>> {
    - backgroundImage: Image
    - cooperativeButton: JButton
    - versusButton: JButton
    - backButton: JButton
    - onCooperative: Runnable
    - onVersus: Runnable
    - onBack: Runnable
    + PvPModeSelectionScreen(onBack: Runnable)
    + setOnCooperative(action: Runnable): void
    + setOnVersus(action: Runnable): void
    - setupPanel(): void
    # paintComponent(g: Graphics): void
}

class PvPCharacterSelectionScreen <<JPanel>> {
    - backgroundImage: Image
    - selectedPlayer1: String
    - selectedPlayer2: String
    - selectedEnemy: String
    - player1Buttons: Map<String, JButton>
    - player2Buttons: Map<String, JButton>
    - enemyButtons: Map<String, JButton>
    - confirmButton: JButton
    - backButton: JButton
    - instructionsLabel: JLabel
    - selectedLabel: JLabel
    - isVersusMode: boolean
    - onConfirm: TriConsumer<String, String, String>
    - onBack: Runnable
    + PvPCharacterSelectionScreen(onBack: Runnable, isVersusMode: boolean)
    + setOnConfirm(action: TriConsumer<String, String, String>): void
    - setupPanel(): void
    - createCharacterButtons(): void
    - createEnemyButtons(): void
    - updateSelection(): void
    # paintComponent(g: Graphics): void
}

class LevelSelectionScreen <<JPanel>> {
    - backgroundImage: Image
    - level1Button: JButton
    - level2Button: JButton
    - level3Button: JButton
    - backButton: JButton
    - onLevelSelected: Consumer<Integer>
    - onBack: Runnable
    + LevelSelectionScreen(onBack: Runnable)
    + setOnLevelSelected(action: Consumer<Integer>): void
    - setupPanel(): void
    - createComponents(): void
    # paintComponent(g: Graphics): void
}

class LevelConfigurationScreen <<JPanel>> {
    - game: BadDopoCream
    - levelNumber: int
    - gameMode: String
    - player1Character: String
    - player2Character: String
    - enemyCharacter: String
    - grapesSpinner: JSpinner
    - bananasSpinner: JSpinner
    - cherriesSpinner: JSpinner
    - pineapplesSpinner: JSpinner
    - cactusSpinner: JSpinner
    - trollsSpinner: JSpinner
    - macetasSpinner: JSpinner
    - calamaresSpinner: JSpinner
    - narvalesSpinner: JSpinner
    - iceWallsSpinner: JSpinner
    - campfiresSpinner: JSpinner
    - hotTilesSpinner: JSpinner
    - startButton: JButton
    - backButton: JButton
    - onLevelStart: LevelStartCallback
    - onBack: Runnable
    + LevelConfigurationScreen(game: BadDopoCream, levelNumber: int, ...)
    + setOnLevelStart(callback: LevelStartCallback): void
    - setupPanel(): void
    - createFruitConfig(): JPanel
    - createEnemyConfig(): JPanel
    - createObstacleConfig(): JPanel
    - buildLevel(): Level
    # paintComponent(g: Graphics): void
}

interface LevelStartCallback <<interface>> {
    + onStart(level: Level): void
}

class LoadingScreen <<JPanel>> {
    - progressBar: JProgressBar
    - statusLabel: JLabel
    - onComplete: Runnable
    + LoadingScreen(onComplete: Runnable)
    - setupPanel(): void
    - startLoading(): void
    # paintComponent(g: Graphics): void
}

class SaveLoadScreen <<JPanel>> {
    - game: BadDopoCream
    - playerColor: String
    - gameMode: String
    - isSaveMode: boolean
    - savesList: JList<String>
    - saveNameField: JTextField
    - onLoadSuccess: Consumer<GameState>
    - onBack: Runnable
    + SaveLoadScreen(game: BadDopoCream, ..., isSaveMode: boolean)
    - setupPanel(): void
    - refreshSavesList(): void
    - saveGame(): void
    - loadGame(saveName: String): void
    - deleteGame(saveName: String): void
    # paintComponent(g: Graphics): void
}

' ============================================
' PANTALLA DE JUEGO
' ============================================

class GameScreen <<JPanel>> {
    - game: BadDopoCream
    - level: Level
    - gameMode: String
    - player1Character: String
    - player2Character: String
    - enemyCharacter: String
    - parentFrame: JFrame
    - gameTimer: Timer
    - aiTimer: Timer
    - iceCreamAI: IceCreamAI
    - iceCreamAI2: IceCreamAI
    - highScoreManager: HighScoreManager
    - pauseButton: JButton
    - saveButton: JButton
    - exitButton: JButton
    - timeLabel: JLabel
    - scoreLabel: JLabel
    - p1ScoreLabel: JLabel
    - p2ScoreLabel: JLabel
    - fruitsLabel: JLabel
    - showingIceAnimation: boolean
    - showingIceAnimationP2: boolean
    - characterConfigurator: CharacterImageConfigurator
    - fruitConfigurator: FruitImageConfigurator
    - enemyConfigurator: EnemyImageConfigurator
    - obstacleConfigurator: ObstacleImageConfigurator
    + GameScreen(game: BadDopoCream, level: Level, gameMode: String, ...)
    - setupPanel(): void
    - createInfoPanel(): JPanel
    - createControlPanel(): JPanel
    - startGameLoop(): void
    - updateGame(): void
    - renderGame(g: Graphics2D): void
    - renderPlayer(g: Graphics2D, player: PlayerInfo, ...): void
    - renderFruits(g: Graphics2D): void
    - renderEnemies(g: Graphics2D): void
    - renderObstacles(g: Graphics2D): void
    - handleKeyPress(keyCode: int): void
    - togglePause(): void
    - checkGameState(): void
    - showVictoryDialog(title: String, message: String): void
    - showGameOverDialog(title: String, message: String): void
    - showHighScoreEntry(score: int, position: int): void
    - showHighScoresTable(): void
    + stopGame(): void
    # paintComponent(g: Graphics): void
}

class KeyboardListener {
    - level: Level
    - game: BadDopoCream
    - gameScreen: GameScreen
    + KeyboardListener(level: Level, game: BadDopoCream, gameScreen: GameScreen)
    + keyPressed(e: KeyEvent): void
    - handlePlayer1Movement(keyCode: int): void
    - handlePlayer2Movement(keyCode: int): void
    - handlePlayer1Ice(keyCode: int): void
    - handlePlayer2Ice(keyCode: int): void
}

' ============================================
' CONFIGURADORES DE IMÁGENES
' ============================================

abstract class BaseImageConfigurator <<Configurator>> {
    # imageCache: Map<String, Image>
    # animationCache: Map<String, ImageIcon>
    + BaseImageConfigurator()
    # loadImage(path: String): Image
    # loadAnimation(path: String): ImageIcon
    # getScaledImage(image: Image, width: int, height: int): Image
    # getScaledAnimation(icon: ImageIcon, width: int, height: int): ImageIcon
}

class CharacterImageConfigurator <<Configurator>> {
    {static} - INSTANCE: CharacterImageConfigurator
    + {static} getInstance(): CharacterImageConfigurator
    + getCharacterImage(character: String, animationType: AnimationType): Image
    + getCharacterAnimation(character: String, animationType: AnimationType): ImageIcon
    + getWalkingAnimation(character: String, dx: int, dy: int): ImageIcon
    + getIceCreatingAnimation(character: String, dx: int, dy: int): ImageIcon
    + getDeathAnimation(character: String): ImageIcon
    + getVictoryAnimation(character: String): ImageIcon
}

enum CharacterAnimationType <<Enum>> {
    WALK_UP
    WALK_DOWN
    WALK_LEFT
    WALK_RIGHT
    ICE_UP
    ICE_DOWN
    ICE_LEFT
    ICE_RIGHT
    DEATH
    VICTORY
    IDLE
}

class FruitImageConfigurator <<Configurator>> {
    {static} - INSTANCE: FruitImageConfigurator
    + {static} getInstance(): FruitImageConfigurator
    + getFruitImage(fruitType: String): Image
    + getFruitAnimation(fruitType: String): ImageIcon
    + getCactusWithSpikes(): Image
    + getCactusWithoutSpikes(): Image
}

class EnemyImageConfigurator <<Configurator>> {
    {static} - INSTANCE: EnemyImageConfigurator
    + {static} getInstance(): EnemyImageConfigurator
    + getEnemyImage(enemyType: String, animationType: AnimationType): Image
    + getEnemyAnimation(enemyType: String, animationType: AnimationType): ImageIcon
    + getWalkingAnimation(enemyType: String, dx: int, dy: int): ImageIcon
    + getChargingAnimation(enemyType: String, dx: int, dy: int): ImageIcon
    + getBreakingIceAnimation(enemyType: String): ImageIcon
}

enum EnemyAnimationType <<Enum>> {
    WALK_UP
    WALK_DOWN
    WALK_LEFT
    WALK_RIGHT
    ATTACK_UP
    ATTACK_DOWN
    ATTACK_LEFT
    ATTACK_RIGHT
    CHARGE_UP
    CHARGE_DOWN
    CHARGE_LEFT
    CHARGE_RIGHT
    BREAKING_ICE
    IDLE
}

class ObstacleImageConfigurator <<Configurator>> {
    {static} - INSTANCE: ObstacleImageConfigurator
    + {static} getInstance(): ObstacleImageConfigurator
    + getObstacleImage(obstacleType: String): Image
    + getIceWallImage(): Image
    + getIceWallBreakingAnimation(): ImageIcon
    + getCampfireAnimation(isLit: boolean): ImageIcon
    + getHotTileAnimation(): ImageIcon
}

class ButtonImageConfigurator <<Configurator>> {
    {static} - INSTANCE: ButtonImageConfigurator
    + {static} getInstance(): ButtonImageConfigurator
    + getButtonImage(buttonType: String, isHovered: boolean): Image
    + styleButton(button: JButton, normalPath: String, hoverPath: String): void
}

' ============================================
' ENUMS DE TIPOS
' ============================================

enum CharacterType <<Enum>> {
    FRESA
    VAINILLA
    CHOCOLATE
    + getDisplayName(): String
    + getColor(): Color
}

enum EnemyType <<Enum>> {
    TROLL
    MACETA
    CALAMAR_NARANJA
    NARVAL
    + getDisplayName(): String
}

' ============================================
' RELACIONES DE HERENCIA
' ============================================

BaseImageConfigurator <|-- CharacterImageConfigurator
BaseImageConfigurator <|-- FruitImageConfigurator
BaseImageConfigurator <|-- EnemyImageConfigurator
BaseImageConfigurator <|-- ObstacleImageConfigurator
BaseImageConfigurator <|-- ButtonImageConfigurator

' ============================================
' RELACIONES DE COMPOSICIÓN
' ============================================

BadDopoCreamGUI "1" *-- "1" GameMenuBar : contiene
BadDopoCreamGUI "1" o-- "0..1" WelcomeScreen : muestra
BadDopoCreamGUI "1" o-- "0..1" MenuPanel : muestra
BadDopoCreamGUI "1" o-- "0..1" GameModeSelectionScreen : muestra
BadDopoCreamGUI "1" o-- "0..1" CharacterSelectionScreen : muestra
BadDopoCreamGUI "1" o-- "0..1" PvPModeSelectionScreen : muestra
BadDopoCreamGUI "1" o-- "0..1" PvPCharacterSelectionScreen : muestra
BadDopoCreamGUI "1" o-- "0..1" LevelSelectionScreen : muestra
BadDopoCreamGUI "1" o-- "0..1" LevelConfigurationScreen : muestra
BadDopoCreamGUI "1" o-- "0..1" GameScreen : muestra
BadDopoCreamGUI "1" o-- "0..1" SaveLoadScreen : muestra
BadDopoCreamGUI "1" o-- "0..1" OptionsScreen : muestra
BadDopoCreamGUI "1" o-- "0..1" LoadingScreen : muestra

GameScreen "1" *-- "1" KeyboardListener : usa
GameScreen "1" *-- "1" CharacterImageConfigurator : usa
GameScreen "1" *-- "1" FruitImageConfigurator : usa
GameScreen "1" *-- "1" EnemyImageConfigurator : usa
GameScreen "1" *-- "1" ObstacleImageConfigurator : usa

LevelConfigurationScreen ..> LevelStartCallback : callback

' ============================================
' RELACIONES CON DOMINIO
' ============================================

BadDopoCreamGUI "1" o-- "1" BadDopoCream : controla
GameScreen "1" o-- "1" BadDopoCream : observa
GameScreen "1" o-- "1" Level : renderiza
GameScreen "1" o-- "0..2" IceCreamAI : controla
GameScreen "1" o-- "1" HighScoreManager : usa
LevelConfigurationScreen "1" o-- "1" BadDopoCream : configura
SaveLoadScreen "1" o-- "1" BadDopoCream : guarda/carga

' ============================================
' NOTAS
' ============================================

note top of BadDopoCreamGUI
  **Ventana principal (JFrame)**
  - Gestiona navegación entre pantallas
  - Mantiene estado del juego actual
  - CardLayout para cambiar vistas
end note

note top of GameScreen
  **Pantalla de juego principal**
  - Game loop a 60 FPS
  - Renderizado de sprites animados
  - Manejo de entrada de teclado
  - Soporte para 1 o 2 jugadores
  - Integración con HighScores
end note

note right of CharacterImageConfigurator
  **Singleton para imágenes**
  - Cache de imágenes cargadas
  - Animaciones GIF
  - Escalado automático
end note

note bottom of LevelConfigurationScreen
  **Configuración de nivel**
  - Spinners para cantidades
  - Previsualización de nivel
  - Validación de configuración
end note

note left of KeyboardListener
  **Control de teclado**
  - WASD: Jugador 1
  - Flechas: Jugador 2
  - Q/E: Hielo J1
  - Numpad 1/3: Hielo J2
  - P/ESC: Pausa
end note

@enduml
